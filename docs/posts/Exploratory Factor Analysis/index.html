<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr Lazaros Gonidis">
<meta name="dcterms.date" content="2025-02-11">

<title>AdvancedStatistics - Exploratory Factor Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">AdvancedStatistics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Exploratory Factor Analysis</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Dr Lazaros Gonidis </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 11, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="todays-aims" class="level2">
<h2 class="anchored" data-anchor-id="todays-aims">Today’s Aims</h2>
<p>Today we will define what <strong>exploratory factor analysis (EFA)</strong> is, we focus on the steps required to carry out <strong>EFA</strong> using <strong>R</strong>.</p>
</section>
<section id="what-is-factor-analysis" class="level2">
<h2 class="anchored" data-anchor-id="what-is-factor-analysis">What is Factor Analysis</h2>
<p>Factor Analysis is the statistical technique that seeks to identify underlying relationships between observed variables.</p>
<p>Specifically, grouping these variables into groups where in-group variables <strong>correlate highly</strong>.</p>
<p>Ideally, we want variables to correlate highly only with their in-group variables, and <strong>correlate weakly or not at all with variables belonging to other groups</strong>.</p>
<p>We will be referring to the term <strong>group</strong> as <strong>factor</strong>. These factors are <strong>unobserved variables</strong>…</p>
</section>
<section id="what-is-exploratory-factor-analysis-efa" class="level2">
<h2 class="anchored" data-anchor-id="what-is-exploratory-factor-analysis-efa">What is Exploratory Factor Analysis (EFA)?</h2>
<p>It is a statistical exploratory process that seeks to identify underlying relationships between observed variables.</p>
<p>Furthermore, with <strong>EFA</strong> we aim to identify <strong>latent variables</strong> that might be responsible for the shared variances between the observed variables. As mentioned in our introduction lectures latent variables are variables that are not directly measured. Instead, they are <strong>inferred by the existing relationships between our observed variables</strong>.</p>
</section>
<section id="specification-of-models-in-efa" class="level2">
<h2 class="anchored" data-anchor-id="specification-of-models-in-efa">Specification of models in EFA</h2>
<p>According to Kline (pages 190-191):</p>
<ol type="1">
<li><strong>EFA</strong> does not require a priori specification, with number of possible factors varying from <strong>one</strong> up to <strong>as many as the indicators</strong>. (Highly not advised, but theoretically possible)</li>
<li>In <strong>EFA</strong> we have <strong>unrestricted measurement models</strong> where indicators are allowed to depend on all factors</li>
<li>Multiple factors models in <strong>EFA</strong> are not actually identified. Headache question: Why would that be the case?</li>
<li>In <strong>EFA</strong> we assume that specific variance of each indicator is not shared with that of any other indicator</li>
</ol>
<p><strong>Note:</strong> Next week we will contrast all the above points with <strong>Confirmatory Factor Analysis (CFA)</strong></p>
</section>
<section id="visualisation" class="level2">
<h2 class="anchored" data-anchor-id="visualisation">Visualisation</h2>
<p><img src="model.JPG" class="img-fluid"></p>
</section>
<section id="do-we-analyze-correlated-factors" class="level2">
<h2 class="anchored" data-anchor-id="do-we-analyze-correlated-factors">Do we analyze correlated Factors?</h2>
<p>Typically this is not required. However, we can specify a <strong>rotation</strong> that will allow us to analyze correlated factors!</p>
<p><strong>Rotation?</strong></p>
<p>Rotation allows us to simplify our model further, thus enhance its interpretation. This is an option that is <strong>applied after our initial solution</strong> and its aim is to achieve a solution where an indicator has high <strong>loading</strong> to one factor (or to as few as possible) and low loading on all other factors.</p>
</section>
<section id="rotations" class="level2">
<h2 class="anchored" data-anchor-id="rotations">Rotations</h2>
<ol type="1">
<li><strong>Orthogonal rotation</strong>, usually the default setting for most <strong>EFA</strong> functions, treats all factors as non-correlated. The most commonly used is <strong>Varimax</strong>, however there are others. Be cautious when using <strong>orthogonal rotations</strong>, refer back to your theoretical background in order to make sure that your possible factors are indeed expected to be <strong>uncorrelated</strong>.</li>
<li><strong>Oblique rotation</strong>, <strong>allows</strong> for correlated factors. The most commonly used is <strong>Promax</strong>, however there are others.</li>
</ol>
<p>So which one should we use? Outside of the <strong>correlated</strong> or <strong>uncorrelated allowance</strong> it is difficult to decide. Many different rotation methods may give similarly valid results. I advise you to look into the <strong>factor score indeterminacy</strong> for more details.</p>
</section>
<section id="software-considerations" class="level2">
<h2 class="anchored" data-anchor-id="software-considerations">Software Considerations</h2>
<p><strong>Can we use lavaan to carry our EFA?</strong></p>
<p>Yes, however …… <strong>psych</strong> package might make your life easier.</p>
<p><strong>EFAtools</strong>, will definitely make your life easier.</p>
<p>We will use all three in combination in the coming examples and you can decide on your own.</p>
</section>
<section id="can-we-always-carry-out-efa" class="level2">
<h2 class="anchored" data-anchor-id="can-we-always-carry-out-efa">Can we always carry out EFA?</h2>
<p>Some researchers argue that you could. You can definitely try, in terms of coding and running the relevant software.</p>
<p>However, you shouldn’t if you do not meet the following two criteria (at minimum).</p>
<p><strong>KMO: Kaiser-Meyer-Olkin measure of sampling adequacy:</strong> Evaluates whether our sample is suitable for factor analysis.It does so by evaluating the proportion of variance among variable that could be attributed to underlying factors. Ranges from <strong>0 - 1</strong>, and values closer to <strong>1</strong> indicate higher suitability.</p>
<p><strong>Bartlett’s test of Sphericity:</strong> Assesses whether our variables/indicators have significant correlations. If our correlations are non-significant then we should not proceed. Here we are looking for evidence (<strong><em>p &lt; .05</em></strong>) in order to reject the null hypothesis that our inter-variable correlations are zero.</p>
</section>
<section id="other-useful-terminology" class="level2">
<h2 class="anchored" data-anchor-id="other-useful-terminology">Other Useful Terminology</h2>
<ol type="1">
<li><strong>Communality:</strong> The proportion of variance explained by the common factor. This will be used as a decision criterion to include or exclude indicators to a factor.</li>
<li><strong>Percentage of Variance:</strong> The percentage of variance that is due to one factor in relation to the total variance in all factors.</li>
<li><strong>Eigenvalue:</strong> The total variance explained by each factor, we are ideally looking for eigenvalues above <strong>1.</strong></li>
</ol>
</section>
<section id="let-us-work-through-an-example-together" class="level2">
<h2 class="anchored" data-anchor-id="let-us-work-through-an-example-together">Let us work through an example together</h2>
<p>First, let’s create the random data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1212</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">### normally distributed factors</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">### these are just to help me set the indicators</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">### the f1 and f2 will not be included in the data.frame</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">250</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">250</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">### f1 indicators x1 to x3</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> f1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> f1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> f1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">### f2 indicators x4 to x6</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> f2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>x5 <span class="ot">&lt;-</span> f2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>x6 <span class="ot">&lt;-</span> f2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">250</span>, <span class="at">sd=</span><span class="fl">0.15</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">### creating the dataframe</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1=</span>x1, <span class="at">x2=</span>x2, <span class="at">x3=</span>x3, <span class="at">x4=</span>x4, <span class="at">x5=</span>x5, <span class="at">x6=</span>x6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assess-kmo-and-bartletts-test-of-sphericity" class="level2">
<h2 class="anchored" data-anchor-id="assess-kmo-and-bartletts-test-of-sphericity">Assess KMO and Bartlett’s test of Sphericity</h2>
<p><strong>EFAtools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EFAtools)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">KMO</span>(df) <span class="do">### THIS IS NOW MASKED BY EFAtools</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
── Kaiser-Meyer-Olkin criterion (KMO) ──────────────────────────────────────────

✔ The overall KMO value for your data is middling.
  These data are probably suitable for factor analysis.

  Overall: 0.795

  For each variable:
   x1    x2    x3    x4    x5    x6 
0.790 0.775 0.819 0.789 0.793 0.807 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BARTLETT</span>(df) <span class="do">### THIS IS NOW MASKED BY EFAtools</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✔ The Bartlett's test of sphericity was significant at an alpha level of .05.
  These data are probably suitable for factor analysis.

  𝜒²(15) = 3272.23, p &lt; .001</code></pre>
</div>
</div>
</section>
<section id="assess-kmo-and-bartletts-test-of-sphericity-1" class="level2">
<h2 class="anchored" data-anchor-id="assess-kmo-and-bartletts-test-of-sphericity-1">Assess KMO and Bartlett’s test of Sphericity</h2>
<p><strong>psych</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">KMO</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kaiser-Meyer-Olkin factor adequacy
Call: psych::KMO(r = df)
Overall MSA =  0.8
MSA for each item = 
  x1   x2   x3   x4   x5   x6 
0.79 0.77 0.82 0.79 0.79 0.81 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">cor</span>(df)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">cortest.bartlett</span>(r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$chisq
[1] 1278.319

$p.value
[1] 2.428264e-263

$df
[1] 15</code></pre>
</div>
</div>
</section>
<section id="determining-number-of-factors" class="level2">
<h2 class="anchored" data-anchor-id="determining-number-of-factors">Determining number of factors</h2>
<p><strong>EFAtools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PARALLEL</span>(df, <span class="at">eigen_type =</span> <span class="st">"PCA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel Analysis performed using 1000 simulated random data sets
Eigenvalues were found using PCA

Decision rule used: means

── Number of factors to retain according to ────────────────────────────────────

◌ PCA-determined eigenvalues:  2</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-revealjs/unnamed-chunk-4-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="determining-number-of-factors-1" class="level2">
<h2 class="anchored" data-anchor-id="determining-number-of-factors-1">Determining number of factors</h2>
<p><strong>psych</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(df, <span class="at">fa=</span><span class="st">"pc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-revealjs/unnamed-chunk-5-1.png" class="img-fluid" width="960"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel analysis suggests that the number of factors =  NA  and the number of components =  2 </code></pre>
</div>
</div>
</section>
<section id="in-efatools-you-can-also-run-multiple-retention-methods" class="level2">
<h2 class="anchored" data-anchor-id="in-efatools-you-can-also-run-multiple-retention-methods">In EFAtools you can also run multiple retention methods</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">N_FACTORS</span>(df, <span class="at">criteria =</span> <span class="fu">c</span>(<span class="st">"PARALLEL"</span>, <span class="st">"EKC"</span>, <span class="st">"SMT"</span>),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">eigen_type_other =</span> <span class="fu">c</span>(<span class="st">"SMC"</span>, <span class="st">"PCA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                                                                                                                                                
  🏃 ◯ ◯ Running EKC
                                                                                                                                                                
 ◉ 🏃 ◯ Running PARALLEL
                                                                                                                                                                
 ◉ ◉ 🏃  Running SMT
                                                                                                                                                                
 ◉ ◉ ◉ Done!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
── Tests for the suitability of the data for factor analysis ───────────────────

Bartlett's test of sphericity

✔ The Bartlett's test of sphericity was significant at an alpha level of .05.
  These data are probably suitable for factor analysis.

  𝜒²(15) = 3272.23, p &lt; .001

Kaiser-Meyer-Olkin criterion (KMO)

✔ The overall KMO value for your data is middling with 0.795.
  These data are probably suitable for factor analysis.

── Number of factors suggested by the different factor retention criteria ──────

◌ Empirical Kaiser criterion: 2
◌ Parallel analysis with PCA: 2
◌ Parallel analysis with SMC: 2
◌ Sequential 𝜒² model tests: 2
◌ Lower bound of RMSEA 90% confidence interval: 2
◌ Akaike Information Criterion: 2</code></pre>
</div>
</div>
</section>
<section id="multiple-scree-plots" class="level2">
<h2 class="anchored" data-anchor-id="multiple-scree-plots">Multiple Scree-plots</h2>
<p>Try the following code at home by removing the #</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># N_FACTORS(df, method = "ULS")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="factor-extraction" class="level2">
<h2 class="anchored" data-anchor-id="factor-extraction">Factor Extraction</h2>
<p><strong>EFAtools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EFA</span>(df, <span class="at">n_factors =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"ML"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
EFA performed with type = 'EFAtools', method = 'ML', and rotation = 'none'.

── Unrotated Loadings ──────────────────────────────────────────────────────────

     F1      F2  
x1  -.561    .815
x2  -.562    .816
x3  -.552    .818
x4   .846    .515
x5   .855    .500
x6   .844    .515

── Variances Accounted for ─────────────────────────────────────────────────────

                     F1      F2  
SS loadings          3.093   2.781
Prop Tot Var         0.515   0.463
Cum Prop Tot Var     0.515   0.979
Prop Comm Var        0.527   0.473
Cum Prop Comm Var    0.527   1.000

── Model Fit ───────────────────────────────────────────────────────────────────

𝜒²(4) =  1.47, p = .832
CFI = 1.00
RMSEA [90% CI] = .00 [.00; .06]
AIC = -6.53
BIC = -20.61
CAF = .50</code></pre>
</div>
</div>
</section>
<section id="rotating-solution" class="level2">
<h2 class="anchored" data-anchor-id="rotating-solution">Rotating solution</h2>
<p><strong>EFAtools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EFA</span>(df, <span class="at">n_factors =</span> <span class="dv">2</span>, <span class="at">rotation =</span> <span class="st">"promax"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
EFA performed with type = 'EFAtools', method = 'PAF', and rotation = 'promax'.

── Rotated Loadings ────────────────────────────────────────────────────────────

     F1      F2  
x1  -.004    .989
x2  -.003    .991
x3   .006    .987
x4   .991    .005
x5   .989   -.012
x6   .989    .007

── Factor Intercorrelations ────────────────────────────────────────────────────

     F1      F2  
F1   1.000  -0.058
F2  -0.058   1.000

── Variances Accounted for ─────────────────────────────────────────────────────

                     F1      F2  
SS loadings          3.107   2.766
Prop Tot Var         0.518   0.461
Cum Prop Tot Var     0.518   0.979
Prop Comm Var        0.529   0.471
Cum Prop Comm Var    0.529   1.000

── Model Fit ───────────────────────────────────────────────────────────────────

CAF: .50
df:   4</code></pre>
</div>
</div>
</section>
<section id="rotating-solution-2-oblimin" class="level2">
<h2 class="anchored" data-anchor-id="rotating-solution-2-oblimin">Rotating solution 2, oblimin</h2>
<p><strong>EFAtools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EFA</span>(df, <span class="at">n_factors =</span> <span class="dv">2</span>, <span class="at">rotation =</span> <span class="st">"oblimin"</span>, <span class="at">method =</span> <span class="st">"ULS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
EFA performed with type = 'EFAtools', method = 'ULS', and rotation = 'oblimin'.

── Rotated Loadings ────────────────────────────────────────────────────────────

     F1      F2  
x1  -.004    .989
x2  -.003    .991
x3   .006    .987
x4   .991    .005
x5   .989   -.012
x6   .989    .007

── Factor Intercorrelations ────────────────────────────────────────────────────

     F1      F2  
F1   1.000  -0.058
F2  -0.058   1.000

── Variances Accounted for ─────────────────────────────────────────────────────

                     F1      F2  
SS loadings          3.107   2.766
Prop Tot Var         0.518   0.461
Cum Prop Tot Var     0.518   0.979
Prop Comm Var        0.529   0.471
Cum Prop Comm Var    0.529   1.000

── Model Fit ───────────────────────────────────────────────────────────────────

𝜒²(4) =  0.00, p =1.000
CFI = 1.00
RMSEA [90% CI] = .00 [.00; .00]
AIC = -8.00
BIC = -22.09
CAF = .50</code></pre>
</div>
</div>
</section>
<section id="factor-extraction-1" class="level2">
<h2 class="anchored" data-anchor-id="factor-extraction-1">Factor Extraction</h2>
<p><strong>psych</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>FA_df<span class="ot">&lt;-</span> <span class="fu">fa</span>(df, <span class="at">nfactors=</span><span class="dv">2</span>, <span class="at">fm=</span><span class="st">"ml"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.psych</span>(FA_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Factor analysis with Call: fa(r = df, nfactors = 2, fm = "ml")

Test of the hypothesis that 2 factors are sufficient.
The degrees of freedom for the model is 4  and the objective function was  0.01 
The number of observations was  250  with Chi Square =  1.45  with prob &lt;  0.84 

The root mean square of the residuals (RMSA) is  0 
The df corrected root mean square of the residuals is  0 

Tucker Lewis Index of factoring reliability =  1.003
RMSEA index =  0  and the 10 % confidence intervals are  0 0.055
BIC =  -20.64
 With factor correlations of 
      ML1   ML2
ML1  1.00 -0.06
ML2 -0.06  1.00</code></pre>
</div>
</div>
</section>
<section id="factor-extraction-psych-continued" class="level2">
<h2 class="anchored" data-anchor-id="factor-extraction-psych-continued">Factor Extraction, psych continued</h2>
<p><strong>Examine the residuals</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals.psych</span>(FA_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1   x2   x3   x4   x5   x6  
x1 0.02                         
x2 0.00 0.02                    
x3 0.00 0.00 0.03               
x4 0.00 0.00 0.00 0.02          
x5 0.00 0.00 0.00 0.00 0.02     
x6 0.00 0.00 0.00 0.00 0.00 0.02</code></pre>
</div>
</div>
</section>
<section id="interpretation-psych" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-psych">Interpretation, psych</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>FA_df<span class="sc">$</span>loadings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
   ML1    ML2   
x1         0.989
x2         0.991
x3         0.987
x4  0.991       
x5  0.989       
x6  0.989       

                 ML1   ML2
SS loadings    2.939 2.935
Proportion Var 0.490 0.489
Cumulative Var 0.490 0.979</code></pre>
</div>
</div>
</section>
<section id="mental-break-down" class="level2">
<h2 class="anchored" data-anchor-id="mental-break-down">Mental Break (down)</h2>
<p>Probably a lot to process in one go. We will take a mental break here and then we will work together through the next example.</p>
</section>
<section id="but-but-what-about-lavaan" class="level2">
<h2 class="anchored" data-anchor-id="but-but-what-about-lavaan">But, but, what about lavaan???</h2>
<p>Yes we have left lavaan out so far. Now is the time to have a look of how we could go through the above process using lavaan (partially).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>efa.model.fit <span class="ot">&lt;-</span> lavaan<span class="sc">::</span><span class="fu">efa</span>(<span class="at">data =</span> df, <span class="at">nfactors =</span> <span class="dv">2</span>, <span class="at">rotation =</span> <span class="st">"promax"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(efa.model.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This is lavaan 0.6.17 -- running exploratory factor analysis

  Estimator                                         ML
  Rotation method                       PROMAX OBLIQUE
  Promax kappa                                       4
  Rotation algorithm (rstarts)              PROMAX (0)
  Standardized metric                             TRUE
  Row weights                                   Kaiser

  Number of observations                           250

Fit measures:
                   aic      bic    sabic chisq df pvalue cfi rmsea
  nfactors = 2 1025.02 1084.885 1030.994 1.478  4  0.831   1     0

Eigenvalues correlation matrix:

     ev1      ev2      ev3      ev4      ev5      ev6 
  3.1285   2.7871   0.0247   0.0214   0.0193   0.0189 

Standardized loadings:

       f1     f2      unique.var   communalities
x1  0.989                  0.021           0.979
x2  0.991                  0.018           0.982
x3  0.987                  0.026           0.974
x4         0.991           0.019           0.981
x5         0.989           0.020           0.980
x6         0.989           0.022           0.978

                              f2    f1 total
Sum of sq (obliq) loadings 2.939 2.935 5.873
Proportion of total        0.500 0.500 1.000
Proportion var             0.490 0.489 0.979
Cumulative var             0.490 0.979 0.979

Factor correlations:

       f1     f2
f1  1.000       
f2 -0.058  1.000</code></pre>
</div>
</div>
</section>
<section id="ok-time-for-our-collaborative-example" class="level2">
<h2 class="anchored" data-anchor-id="ok-time-for-our-collaborative-example">OK, time for our collaborative example</h2>
<p>We will use a lavaan built-in dataset called <strong>HolzingerSwineford1939</strong></p>
<p>The data consists of mental ability test scores of seventh- and eighth-grade children from two different schools (Pasteur and Grant-White). In our version of the dataset, only 9 out of the original 26 tests are included. A CFA model that is often proposed for these 9 variables consists of three latent variables (or factors), each with three indicators:</p>
<ul>
<li><p>a <em>visual</em> factor measured by 3 variables: <code>x1</code>, <code>x2</code> and <code>x3</code></p></li>
<li><p>a <em>textual</em> factor measured by 3 variables: <code>x4</code>, <code>x5</code> and <code>x6</code></p></li>
<li><p>a <em>speed</em> factor measured by 3 variables: <code>x7</code>, <code>x8</code> and <code>x9</code></p></li>
</ul>
</section>
<section id="visual-model" class="level2">
<h2 class="anchored" data-anchor-id="visual-model">Visual Model</h2>
<p><img src="model2.JPG" class="img-fluid" width="408"></p>
</section>
<section id="let-us-assign-the-data-to-a-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="let-us-assign-the-data-to-a-dataframe">Let us assign the data to a dataframe</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(HolzingerSwineford1939)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> HolzingerSwineford1939</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id sex ageyr agemo  school grade       x1   x2    x3       x4   x5        x6
1  1   1    13     1 Pasteur     7 3.333333 7.75 0.375 2.333333 5.75 1.2857143
2  2   2    13     7 Pasteur     7 5.333333 5.25 2.125 1.666667 3.00 1.2857143
3  3   2    13     1 Pasteur     7 4.500000 5.25 1.875 1.000000 1.75 0.4285714
4  4   1    13     2 Pasteur     7 5.333333 7.75 3.000 2.666667 4.50 2.4285714
5  5   2    12     2 Pasteur     7 4.833333 4.75 0.875 2.666667 4.00 2.5714286
6  6   2    14     1 Pasteur     7 5.333333 5.00 2.250 1.000000 3.00 0.8571429
        x7   x8       x9
1 3.391304 5.75 6.361111
2 3.782609 6.25 7.916667
3 3.260870 3.90 4.416667
4 3.000000 5.30 4.861111
5 3.695652 6.30 5.916667
6 4.347826 6.65 7.500000</code></pre>
</div>
</div>
</section>
<section id="keep-only-the-indicators-columns" class="level2">
<h2 class="anchored" data-anchor-id="keep-only-the-indicators-columns">Keep only the indicators columns</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df2 <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-should-be-our-first-step" class="level2">
<h2 class="anchored" data-anchor-id="what-should-be-our-first-step">What should be our first step?</h2>


</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>